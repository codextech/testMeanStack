!function(t){"use strict";t.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",loadingFunction:!1,padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var n=function(n,e){var l=n.data("jscroll"),o="function"==typeof e?{callback:e}:e,r=t.extend({},t.jscroll.defaults,o,l||{}),i="visible"===n.css("overflow-y"),c=n.find(r.nextSelector).first(),a=t(r.container?r.container:window),s=t("body"),d=i?a:n,f=t.trim(c.attr("href")+" "+r.contentSelector),g=function(){n.find(".jscroll-inner").length||n.contents().wrapAll('<div class="jscroll-inner" />')},u=function(t){r.pagingSelector?t.closest(r.pagingSelector).hide():t.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide().length||t.wrap('<div class="jscroll-next-parent" />').parent().hide()},p=function(){return d.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()},j=function(){if(n.is(":visible")){g();var t=n.find("div.jscroll-inner").first(),e=n.data("jscroll"),l=parseInt(n.css("borderTopWidth"),10),o=isNaN(l)?0:l,c=parseInt(n.css("paddingTop"),10)+o,a=i?d.scrollTop():n.offset().top,s=t.length?t.offset().top:0,f=Math.ceil(a-s+d.height()+c);if(!e.waiting&&f+r.padding>=t.outerHeight())return m("info","jScroll:",t.outerHeight()-f,"from bottom. Loading next request..."),b()}},h=function(t){return(t=t||n.data("jscroll"))&&t.nextHref?(v(),!0):(m("warn","jScroll: nextSelector not found - destroying"),p(),!1)},v=function(){var e=n.find(r.nextSelector).first();if(e.length)if(r.autoTrigger&&(!1===r.autoTriggerUntil||r.autoTriggerUntil>0)){u(e);var l=s.height()-n.offset().top;(n.height()<l?n.height():l)<=(n.offset().top-a.scrollTop()>0?a.height()-(n.offset().top-t(window).scrollTop()):a.height())&&j(),d.unbind(".jscroll").bind("scroll.jscroll",function(){return j()}),r.autoTriggerUntil>0&&r.autoTriggerUntil--}else d.unbind(".jscroll"),e.bind("click.jscroll",function(){return u(e),b(),!1})},b=function(){var e=n.find("div.jscroll-inner").first(),l=n.data("jscroll");return l.waiting=!0,e.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading" id="jscroll-loading">'+r.loadingHtml+"</div>").promise().done(function(){r.loadingFunction&&r.loadingFunction()}),n.animate({scrollTop:e.outerHeight()},0,function(){var o=l.nextHref;e.find("div.jscroll-added").last().load(o,function(e,i){if("error"===i)return p();var c=t(this).find(r.nextSelector).first();l.waiting=!1,l.nextHref=!!c.attr("href")&&t.trim(c.attr("href")+" "+r.contentSelector),t(".jscroll-next-parent",n).remove(),h(),r.callback&&r.callback.call(this,o),m("dir",l)})})},m=function(t){if(r.debug&&"object"==typeof console&&("object"==typeof t||"function"==typeof console[t]))if("object"==typeof t){var n=[];for(var e in t)"function"==typeof console[e]?(n=t[e].length?t[e]:[t[e]],console[e].apply(console,n)):console.log.apply(console,n)}else console[t].apply(console,Array.prototype.slice.call(arguments,1))};return n.data("jscroll",t.extend({},l,{initialized:!0,waiting:!1,nextHref:f})),g(),function(){var n=t(r.loadingHtml).filter("img").attr("src");n&&((new Image).src=n)}(),v(),t.extend(n.jscroll,{destroy:p}),n};t.fn.jscroll=function(e){return this.each(function(){var l=t(this),o=l.data("jscroll");o&&o.initialized||n(l,e)})}}(jQuery);